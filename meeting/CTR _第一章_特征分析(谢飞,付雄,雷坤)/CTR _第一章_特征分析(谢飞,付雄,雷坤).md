# W1:数据探索

作者：谢飞(Orchid)，付雄(fuxi)，雷坤 (Nukiel)
日期：2018/6/16
[TOC]

## W1.1 特征意义及推测

对于一支广告的投放，可以描述为这样一种行为，即在某地，某个时候， 通过某种途径，在某种平台上，向某类对象展示某种形式的信息传播方式。

而能够被点击则意味着这个传播得到了反馈,是有效的投放。影响用户能够对广告的进行点击的因素很多，比如广告是否足够吸引眼球，展示的内容是否刚好就是用户查找的东西，这些因素会导致用户主动去点击广告；但是，很多时候用户取点击广告是一个“被迫”行为，比如观看视频前的插入广告，浏览新闻的内容植入广告，弹窗广告等，用户不想点击，但是不点击就影响了他正常的阅览；最后，还有很多广告是通过误导用户去点击，比如关闭的X很难找，触摸屏展示时用户很容易就点击了广告而不是关掉广告。

因为广告都是讨人厌的，某只广告刚刚被用户误点了或者主动去点了，它接着马上又弹出来了，很多人就很恼火，这个时候再去点击这个广告概率就很低，也就是说用户的历史点击某只广告会影响其下次点击这个广告的可能性。

对训练集进行每个特征去重数据统计，得到如下表：

     **表1: 特征统计表**

| 特征             | 特征取值                                       | 特征取值总数 |
| ---------------- | ---------------------------------------------- | ------------ |
| id               | 5.21159374e+11                                 | 40428967     |
| click            | 0,1                                            | 2            |
| hour             | 14102100 14102101                              | 240          |
| C1               | 1001 1002 1005 1007 1008 1010 1012             | 7            |
| banner_pos       | 0 1 2 3 4 5 7                                  | 8            |
| site_id          | '000aa1a4' ' ... 'fffe8e1c'                    | 4737         |
| site_domain      | '004d30ed' ... 'ffdec903'                      | 7745         |
| site_category    | '0569f928' …'f66779e6'                         | 26           |
| app_id           | '000d6291' ... 'ffef3b38'                      | 8552         |
| app_domain       | 'fea0d84a'…'ff6630e0'                          | 559          |
| app_category     | 'd1327cf5' …'fc6fa53d'                         | 36           |
| device_id        | '00000919' ... 'ffffde2c'                      | 2686408      |
| device_ip        | '00000911' ... 'fffff971'                      | 6729486      |
| device_model     | '000ab70c' ... 'ffe72be2'                      | 8251         |
| device_type­­­   | 0 1 2 4 5                                      | 5            |
| device_conn_type | 0 2 3 5                                        | 4            |
| C14              | 375 ... 24052                                  | 2626         |
| C15              | 120    216  300  320    480  728  768 1024     | 8            |
| C16              | 20     36   50   90    250  320  480  768 1024 | 9            |
| C17              | 112…2758                                       | 435          |
| C18              | 0 1 2 3                                        | 4            |
| C19              | 33…1959                                        | 68           |
| C20              | -1 100000 100001…100248                        | 172          |
| C21              | 1 … 219                                        | 60           |

 

基于上面的分析，对于数据集中的24个特征，可以向分几个大类：

1. 何时
  hour：可以抽取为哪天，哪小时
  **时间代表了用户的广告点击历史，历史浏览会对未来广告点击产生影响**

2. 何地
  site_id：网站编号，某个场地的唯一标识
  site_domain：网页地址
  site_category：网站类别，这个场地可能是网页，视频网站，社交社区之类的
  **不同的网站用户流量不一样，比如Facebook的广告点击率必然比我的个人博客广告点击率；而不同类别网站也会影响广告点击，比如优酷和新华网，我想优酷的广告点击率应该比新华网高，因为优酷实在太流氓**

  
  app_id：应用程序的编号
  app_domain：应用程序领域
  app_category：应用程序类别
  **应用程序，不同的类别程序，对广告点击应该有一定影响，比如游戏类的APP，投放游戏广告，点击率会高些**

3. 何平台
  device_id：设备标识，比如苹果5,华为 P8之类的
  device_model：设备模式，？
  device_type：设备类型，比如可能是苹果，华为，小米，黑莓等
  device_ip：设备ip，上网的ip地址
  device_conn_type：上网的连接方式，比如移动上网，WIFI等
  **平台对广告的影响也是很重要，比如苹果手机上豪车豪宅的广告点击率必然比小米手机上广告的点击率高些，这里不是黑小米用户，我这里只是陈述一个概率事实。又比如，WIFI上网点击广告的概率肯定比用移动上网的高些，试问谁会用移动流量去点个广告，浪费时间和金钱？[土豪例外]。ip地址基本可以代表用户的区域特征，不同区域的用户对于广告的点击会有影响，比如美国的ip和越南的ip，他们对橄榄球广告的点击率必然不一样**

4. 何种方式
  banner_pos：广告展示位置
  C1：难以推测，很可能是广告的展示形式，比如视频，文字，弹窗等
  C14：无法推测
  C15 X C16：广告的尺寸,比如iphone4/4s的是320 X 480,ipad1/2的是768 X 1024
  C17：无法推测
  C18：无法推测
  C19：无法推测
  C20：无法推测
  C21：无法推测
  **广告的展示方式是体现广告商功力的地方，所以这里很多信息都被脱敏处理了，这些特征中的各个类除非对点击率影响均衡，也就是方差很小，可以忽略，否则都应该输入模型进行训练**

5. 何人
  数据集中没有明确给出，也不方便给出。其实何人会是影响广告点击的一个重要变量，比如女生对于女性用品的广告点击会很高，而男生对于汽车游戏类的广告点击会更高；30岁左右的成年人会对婴幼儿广告更加感冒，而60岁的人会对保健品更加感兴趣等等，但是这些有关性别，年龄，教育水平等用户隐私的数据是受到保护的，就算广告商有这个数据，也不会公布出来。
  欧盟《通用数据保护条例》规定，违规泄露用户隐私数据，企业将面临高达全球营业额２％至４％的罚款。
  我们这里基本上可以用device_id或者device_ip来作为用户的代号

  

## W1.2 特征分析

### 1.2.1 全局点击率

```python
i=0
fea0=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
global_CTR=np.sum(np.sum(fea0[fea0.columns[2]]))/np.sum(np.sum(fea0[fea0.columns[1]]))*100
print('训练集的全局点击率为: %6.2f %%' % global_CTR)
```

    训练集的全局点击率为:  16.98 %

**整个训练集的平均点击率16.98%将作为考量各个特征中不同取值的重要性指标,如果比整个平均值大,那么就处于相对重要的地位.**

### 1.2.2 hour

    按12个时辰分割的时间与点击率的统计表:
    +----+--------+----------------+--------------+--------------+
    |    | hour   |   count(click) |   sum(click) |   avg(click) |
    |----+--------+----------------+--------------+--------------|
    |  0 | 0-1    |    1.82996e+06 |       335376 |     0.183269 |
    |  1 | 2-3    |    2.62167e+06 |       459027 |     0.175089 |
    |  2 | 4-5    |    3.89553e+06 |       629171 |     0.161511 |
    |  3 | 6-7    |    3.62046e+06 |       629230 |     0.173799 |
    |  4 | 8-9    |    4.37266e+06 |       706581 |     0.16159  |
    |  5 | 10-11  |    4.20179e+06 |       696402 |     0.16574  |
    |  6 | 12-13  |    4.60531e+06 |       780787 |     0.16954  |
    |  7 | 14-15  |    4.28494e+06 |       768185 |     0.179276 |
    |  8 | 16-17  |    4.07995e+06 |       719585 |     0.176371 |
    |  9 | 18-19  |    3.07661e+06 |       511894 |     0.166383 |
    | 10 | 20-21  |    2.11361e+06 |       339411 |     0.160584 |
    | 11 | 22-23  |    1.72648e+06 |       289417 |     0.167635 |
    +----+--------+----------------+--------------+--------------+


    hour之CTR分布图:

![png](./img/output_4_1.png)

    hour统计表:
           count(click)     sum(click)  avg(click)
    count  1.200000e+01      12.000000   12.000000
    mean   3.369081e+06  572088.833333    0.170066
    std    1.053165e+06  178455.709957    0.007456
    min    1.726476e+06  289417.000000    0.160584
    25%    2.494657e+06  429123.000000    0.164702
    50%    3.757991e+06  629200.500000    0.168588
    75%    4.222575e+06  709832.000000    0.175410
    max    4.605313e+06  780787.000000    0.183269

**中国古人根据动物出没习性将24小时分了12个时辰,这里也按照12个时辰将每天分为12份,进行广告点击率的时间分布统计.**
**从上面的分析可知,不同的时间段,其分布标准差非常小,说明不同时段的点击率差异很小.**

<img src="./EDA/Hour_vs_click.png" style="zoom:50%" />

**但是从按照时间序列绘制的图,可知某些时段，广告出现次数比较多，点击数也比较多，呈现一个高峰，但是点击率却是低谷。**

**对于时间这个变量可以做点文章**

### 1.2.3 C1

脱敏特征的统计汇总：

|          | C1       | C14      | C15      | C16      | C17      | C18      | C19      | C20      | C21      |
| -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |
| 总数     | 40428967 | 40428967 | 40428967 | 40428967 | 40428967 | 40428967 | 40428967 | 40428967 | 40428967 |
| 独一数   | 7        | 2626     | 8        | 9        | 435      | 4        | 68       | 172      | 60       |
| 最高频值 | 1005     | 4687     | 320      | 50       | 1722     | 0        | 35       | 65535    | 23       |
| 最高频次 | 37140632 | 948215   | 37708959 | 38136554 | 4513492  | 16939044 | 12170630 | 18937918 | 8896205  |



```python
i=1
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea, headers='keys', numalign="left",tablefmt='psql'))
```

    C1与点击率的统计表:共7不同取值
    +----+------+----------------+--------------+--------------+
    |    | C1   | count(click)   | sum(click)   | avg(click)   |
    |----+------+----------------+--------------+--------------|
    | 0  | 1001 | 9463           | 316          | 0.0333932    |
    | 1  | 1002 | 2.22081e+06    | 467995       | 0.210731     |
    | 2  | 1005 | 3.71406e+07    | 6.28906e+06  | 0.169331     |
    | 3  | 1007 | 35304          | 1392         | 0.039429     |
    | 4  | 1008 | 5787           | 704          | 0.121652     |
    | 5  | 1010 | 903457         | 86023        | 0.0952154    |
    | 6  | 1012 | 113512         | 19580        | 0.172493     |
    +----+------+----------------+--------------+--------------+
```
C1之CTR分布图:
```
![png](./EDA/C1_vs_click.png)

**C1这个变量点击率分布很分散,从对模型训练的角度,能够体现差异,是优质特征**

**取值1002 和 1005，几乎占领了90%以上的广告投放量。就点击数1005这个取值是被点击最多的，**

### 1.2.4 banner_pos


```python
i=2
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea, headers='keys', numalign="left",tablefmt='psql'))
```

    banner_pos与点击率的统计表:共7不同取值
    +----+--------------+----------------+--------------+--------------+
    |    | banner_pos   | count(click)   | sum(click)   | avg(click)   |
    |----+--------------+----------------+--------------+--------------|
    | 0  | 0            | 2.91096e+07    | 4.7819e+06   | 0.164272     |
    | 1  | 1            | 1.12473e+07    | 2.06516e+06  | 0.183614     |
    | 2  | 2            | 13001          | 1550         | 0.119222     |
    | 3  | 3            | 2035           | 372          | 0.182801     |
    | 4  | 4            | 7704           | 1428         | 0.185358     |
    | 5  | 5            | 5778           | 702          | 0.121495     |
    | 6  | 7            | 43577          | 13949        | 0.3201       |
    +----+--------------+----------------+--------------+--------------+


    banner_pos之CTR分布图:

![png](./EDA/Banner_pos_vs_click.png)

**banner_pos这个变量点击率分散程度也还行,需要注意的是取值7的点击率尤其高,这个位置很可能是屏幕中间位置,展示出来会影响用户阅读,没办法必须要点掉. 这种广告不能投放太多.**

**在位置0和位置1，几乎占领了90%以上的广告投放量。**

### 1.2.5 site_id

和网站有关的三个类别型变量统计：

|          | site_id  | site_domain | site_category |
| -------- | -------- | ----------- | ------------- |
| 总数     | 40428967 | 40428967    | 40428967      |
| 独一数   | 4737     | 7745        | 26            |
| 最高频值 | 85f751fd | c4e18dd6    | 50e219e0      |
| 最高频数 | 14596137 | 15131739    | 16537234      |



```python
i=3
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    site_id与点击率的统计表:共4737不同取值
    +------+-----------+----------------+--------------+--------------+
    |      | site_id   | count(click)   | sum(click)   | avg(click)   |
    |------+-----------+----------------+--------------+--------------|
    | 2494 | 85f751fd  | 14596137       | 1734407      | 0.118826     |
    | 582  | 1fbe01fe  | 6486150        | 1333764      | 0.205633     |
    | 4158 | e151e245  | 2637747        | 781628       | 0.296324     |
    | 4032 | d9750ee7  | 963745         | 269965       | 0.280121     |
    | 1748 | 5b08c53b  | 913325         | 426710       | 0.467205     |
    | 1753 | 5b4d2eda  | 771360         | 100287       | 0.130013     |
    | 2486 | 856e6d3f  | 765891         | 32746        | 0.0427554    |
    | 3093 | a7853007  | 461311         | 47188        | 0.102291     |
    | 3395 | b7e9786d  | 369099         | 27319        | 0.0740154    |
    | 1816 | 5ee41ff2  | 349008         | 115605       | 0.331239     |
    | 1909 | 6399eda6  | 343703         | 36411        | 0.105937     |
    | 1762 | 5bcf81a2  | 340050         | 39284        | 0.115524     |
    | 1891 | 6256f5b4  | 315840         | 55596        | 0.176026     |
    | 1705 | 57ef2c87  | 310760         | 37732        | 0.121418     |
    | 431  | 17caea14  | 278322         | 67720        | 0.243315     |
    | 194  | 0a742914  | 269725         | 72358        | 0.268266     |
    | 2456 | 83a0ad1a  | 268735         | 22871        | 0.0851061    |
    | 1708 | 57fe1b20  | 264952         | 65312        | 0.246505     |
    | 4212 | e4d8dd7b  | 259347         | 30990        | 0.119492     |
    | 4293 | e8f79e60  | 259289         | 66207        | 0.255341     |
    +------+-----------+----------------+--------------+--------------+


    site_id统计表:
           count(click)    sum(click)   avg(click)
    count  4.737000e+03  4.737000e+03  4737.000000
    mean   8.534720e+03  1.449243e+03     0.179476
    std    2.372673e+05  3.479911e+04     0.226505
    min    1.000000e+00  0.000000e+00     0.000000
    25%    5.000000e+00  0.000000e+00     0.000000
    50%    3.700000e+01  4.000000e+00     0.107976
    75%    3.850000e+02  4.400000e+01     0.250000
    max    1.459614e+07  1.734407e+06     1.000000

<img src="./EDA/Site_id_vs_Click.png" style="zoom:50%" />

**网站的编号对于点击率的标准差应该不会很低,不同的网站,点击率肯定有差别,但是网站编号实在太多了,编码后维度爆炸是不得不考虑的问题.**

**从点击数和投放数看，投放的越多，点击数就越大，这个结果也符合一般的常识**

### 1.2.6 site_domain


```python
i=4
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    site_domain与点击率的统计表:共7745不同取值
    +------+---------------+----------------+--------------+--------------+
    |      | site_domain   | count(click)   | sum(click)   | avg(click)   |
    |------+---------------+----------------+--------------+--------------|
    | 6000 | c4e18dd6      | 15131739       | 1857423      | 0.12275      |
    | 7339 | f3845767      | 6486150        | 1333764      | 0.205633     |
    | 3893 | 7e091613      | 3325008        | 859040       | 0.258357     |
    | 3666 | 7687a86e      | 1290165        | 593264       | 0.459836     |
    | 4672 | 98572c79      | 996816         | 273496       | 0.27437      |
    | 686  | 16a36ef3      | 855686         | 121731       | 0.142261     |
    | 2736 | 58a89a43      | 765891         | 32746        | 0.0427554    |
    | 4841 | 9d54950b      | 375891         | 42231        | 0.112349     |
    | 5417 | b12b9f85      | 373925         | 27991        | 0.0748573    |
    | 725  | 17d996e6      | 353600         | 116237       | 0.328725     |
    | 4615 | 968765cd      | 343703         | 36411        | 0.105937     |
    | 1294 | 28f93029      | 315842         | 55598        | 0.176031     |
    | 5772 | bd6d812f      | 310760         | 37732        | 0.121418     |
    | 6421 | d262cf1e      | 289921         | 6403         | 0.0220853    |
    | 417  | 0dde25ec      | 278322         | 67720        | 0.243315     |
    | 2516 | 510bd839      | 269725         | 72358        | 0.268266     |
    | 2859 | 5c9ae867      | 268735         | 22871        | 0.0851061    |
    | 2822 | 5b626596      | 265874         | 65346        | 0.245778     |
    | 4970 | a17bde68      | 259347         | 30990        | 0.119492     |
    | 5986 | c4342784      | 259289         | 66207        | 0.255341     |
    +------+---------------+----------------+--------------+--------------+
    
    site_domain统计表:
           count(click)    sum(click)   avg(click)
    count  7.745000e+03  7.745000e+03  7745.000000
    mean   5.220009e+03  8.863868e+02     0.188611
    std    1.927291e+05  2.890054e+04     0.272498
    min    1.000000e+00  0.000000e+00     0.000000
    25%    1.000000e+00  0.000000e+00     0.000000
    50%    7.000000e+00  1.000000e+00     0.071429
    75%    6.600000e+01  9.000000e+00     0.264695
    max    1.513174e+07  1.857423e+06     1.000000

<img src="./EDA/Site_domain_vs_Click.png" style="zoom:50%" />

**site_domain应该指网站域名还是网页地址?**

**根据其数目比网站编号多,认为理解为网页地址更合理.这个特征和网站地址一样,不同的取值对点击率会有比较明显的影响,但存在维度爆炸的危险**

**site_domain这个特征和site_id的分布很类似**

### 1.2.7 site_category


```python
i=5
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea, headers='keys', numalign="left",tablefmt='psql'))
```

    site_category与点击率的统计表:共26不同取值
    +----+-----------------+----------------+--------------+--------------+
    |    | site_category   | count(click)   | sum(click)   | avg(click)   |
    |----+-----------------+----------------+--------------+--------------|
    | 6  | 50e219e0        | 16537234       | 2126350      | 0.12858      |
    | 24 | f028772b        | 12657073       | 2272940      | 0.179579     |
    | 2  | 28905ebd        | 7377208        | 1534600      | 0.208019     |
    | 4  | 3e814130        | 3050306        | 863245       | 0.283003     |
    | 25 | f66779e6        | 252451         | 10019        | 0.0396869    |
    | 12 | 75fa27f6        | 160985         | 17915        | 0.111284     |
    | 3  | 335d28a8        | 136463         | 12779        | 0.0936444    |
    | 13 | 76b2941d        | 104754         | 3170         | 0.0302614    |
    | 19 | c0dd3be3        | 42090          | 4714         | 0.111998     |
    | 10 | 72722551        | 28216          | 1626         | 0.0576269    |
    | 22 | dedf689d        | 24500          | 12593        | 0.514        |
    +----+-----------------+----------------+--------------+--------------+
    
    site_category统计表:
           count(click)    sum(click)  avg(click)
    count  2.600000e+01  2.600000e+01   26.000000
    mean   1.554960e+06  2.640410e+05    0.098765
    std    4.169734e+06  6.625992e+05    0.115663
    min    2.000000e+00  0.000000e+00    0.000000
    25%    3.592500e+02  6.250000e+00    0.013143
    50%    1.229400e+04  7.520000e+02    0.065621
    75%    1.285358e+05  1.194950e+04    0.134254
    max    1.653723e+07  2.272940e+06    0.514000


<img src="./EDA/Site_category_vs_Click.png" style="zoom:20%" />

**网站/网页类别的取值不同,对于点击率的影响也会不同,从标准差看,影响的差异比网站的取值要小点,也就是说优酷的游戏频道和电影频道,上面的广告点击率有差别,但是差别没有youtube电影频道和优酷电影频道上的点击率差别大.**

**从图和表发现，category为*dedf689d* 的site 广告点击率非常高，而投放数却非常低，在图上几乎肉眼不可见。通常影响广告投放的数量，除了点击率，还有一个就是广告的价格，这个取值的广告点击率如此之高，投放量却很少，应该是性价比不高的。 ** 

### 1.2.8 app_id

和app有关的三个类别特征的统计汇总如下：

|          | app_id   | app_domain | app_category |
| -------- | -------- | ---------- | ------------ |
| 总数     | 40428967 | 40428967   | 40428967     |
| 独一数   | 8552     | 559        | 36           |
| 最高频值 | ecad2386 | 7801e8d9   | 07d7df22     |
| 最高频数 | 25832830 | 27237087   | 26165592     |




```python
i=6
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    app_id与点击率的统计表:共8552不同取值
    +------+----------+----------------+--------------+--------------+
    |      | app_id   | count(click)   | sum(click)   | avg(click)   |
    |------+----------+----------------+--------------+--------------|
    | 7884 | ecad2386 | 25832830       | 5130659      | 0.19861      |
    | 4904 | 92f5800b | 1555283        | 30014        | 0.0192981    |
    | 7558 | e2fcccd2 | 1129016        | 219689       | 0.194584     |
    | 8510 | febd1138 | 759098         | 36597        | 0.0482112    |
    | 5187 | 9c13b419 | 757812         | 231387       | 0.305336     |
    | 3882 | 7358e05e | 615635         | 115311       | 0.187304     |
    | 5506 | a5184c22 | 491457         | 121513       | 0.247251     |
    | 7058 | d36838b1 | 457572         | 32497        | 0.0710205    |
    | 3521 | 685d1c4c | 408515         | 31055        | 0.0760192    |
    | 2837 | 54c5d545 | 397693         | 49410        | 0.124242     |
    | 109  | 03528b27 | 322121         | 44256        | 0.137389     |
    | 8014 | f0d41ff1 | 294244         | 17657        | 0.060008     |
    | 7778 | e9739828 | 284750         | 7990         | 0.0280597    |
    | 7547 | e2a1ca37 | 281215         | 39231        | 0.139505     |
    | 2698 | 51cedd4e | 239107         | 12469        | 0.0521482    |
    | 3472 | 66f5e02e | 226077         | 51263        | 0.22675      |
    | 122  | 03a08c3f | 218767         | 12532        | 0.0572847    |
    | 5099 | 98fed791 | 218766         | 29975        | 0.137019     |
    | 3873 | 73206397 | 200058         | 5883         | 0.0294065    |
    | 8181 | f53417e1 | 199043         | 13805        | 0.0693569    |
    +------+----------+----------------+--------------+--------------+
    
    app_id统计表:
           count(click)    sum(click)   avg(click)
    count  8.552000e+03  8.552000e+03  8552.000000
    mean   4.727428e+03  8.027439e+02     0.183707
    std    2.807550e+05  5.563412e+04     0.278578
    min    1.000000e+00  0.000000e+00     0.000000
    25%    2.000000e+00  0.000000e+00     0.000000
    50%    8.000000e+00  1.000000e+00     0.034093
    75%    5.100000e+01  5.000000e+00     0.263158
    max    2.583283e+07  5.130659e+06     1.000000

<img src="./EDA/App_id_vs_Click.png" style="zoom:50%" />

**app编号与网站编号一样,点击率的标准差也不低,编码维度爆炸是不得不考虑的问题.**

### 1.2.9 app_domain


```python
i=7
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    app_domain与点击率的统计表:共559不同取值
    +-----+--------------+----------------+--------------+--------------+
    |     | app_domain   | count(click)   | sum(click)   | avg(click)   |
    |-----+--------------+----------------+--------------+--------------|
    | 254 | 7801e8d9     | 27237087       | 5307891      | 0.194877     |
    | 75  | 2347f47a     | 5240885        | 723839       | 0.138114     |
    | 378 | ae637522     | 1881838        | 44753        | 0.0237815    |
    | 200 | 5c5a694b     | 1129228        | 219699       | 0.194557     |
    | 282 | 82e27996     | 759125         | 36598        | 0.0482108    |
    | 478 | d9b5648e     | 713924         | 79275        | 0.111041     |
    | 19  | 0e8616ad     | 660510         | 46766        | 0.0708029    |
    | 410 | b9528b13     | 646193         | 116883       | 0.180879     |
    | 407 | b8d325c3     | 534000         | 124073       | 0.232346     |
    | 380 | aefc06bd     | 298769         | 21369        | 0.0715235    |
    | 490 | df32afa9     | 291502         | 8129         | 0.0278866    |
    | 110 | 33da2e74     | 259530         | 31133        | 0.119959     |
    | 241 | 6f7ca2ba     | 226100         | 51263        | 0.226727     |
    | 197 | 5b9c592b     | 104413         | 5990         | 0.0573683    |
    | 290 | 885c7f3f     | 68310          | 11490        | 0.168204     |
    | 201 | 5c620f04     | 60268          | 1648         | 0.0273445    |
    | 147 | 45a51db4     | 56138          | 11291        | 0.201129     |
    | 400 | b5f3b24a     | 48199          | 1912         | 0.0396689    |
    | 278 | 813f3323     | 25338          | 2915         | 0.115045     |
    | 8   | 0654b444     | 23298          | 4679         | 0.200833     |
    +-----+--------------+----------------+--------------+--------------+
    
    app_domain统计表:
           count(click)    sum(click)  avg(click)
    count  5.590000e+02  5.590000e+02  559.000000
    mean   7.232373e+04  1.228098e+04    0.149005
    std    1.177570e+06  2.268175e+05    0.267377
    min    1.000000e+00  0.000000e+00    0.000000
    25%    2.000000e+00  0.000000e+00    0.000000
    50%    6.000000e+00  1.000000e+00    0.014388
    75%    4.850000e+01  4.000000e+00    0.153846
    max    2.723709e+07  5.307891e+06    1.000000

<img src="./EDA/App_domain_vs_Click.png" style="zoom:30%" />

**图中灰色，玫红色代表着这类领域的APP广告投放量比较多，点击数也相应的增大。**

**从点击率的分布和标准差看，存在一点的差别**

**app的领域和类别取值还不算太多, 可以保留进入训练.**

### 1.2.10 app_category


```python
i=8
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea, headers='keys', numalign="left",tablefmt='psql'))
```

    app_category与点击率的统计表:共36不同取值
    +----+----------------+----------------+--------------+--------------+
    |    | app_category   | count(click)   | sum(click)   | avg(click)   |
    |----+----------------+----------------+--------------+--------------|
    | 0  | 07d7df22       | 26165592       | 5210822      | 0.199148     |
    | 4  | 0f2161f8       | 9561058        | 1033720      | 0.108118     |
    | 29 | cef3e649       | 1731545        | 161450       | 0.0932404    |
    | 21 | 8ded1f7a       | 1467257        | 132021       | 0.0899781    |
    | 34 | f95efa07       | 1141673        | 282664       | 0.247588     |
    | 30 | d1327cf5       | 123233         | 15197        | 0.123319     |
    | 1  | 09481d60       | 54886          | 8518         | 0.155194     |
    | 31 | dc97ec06       | 54644          | 8552         | 0.156504     |
    | 17 | 75d80bbe       | 40108          | 3849         | 0.0959659    |
    | 35 | fc6fa53d       | 23663          | 1148         | 0.0485146    |
    | 11 | 4ce2e9fc       | 20762          | 2570         | 0.123784     |
    | 20 | 879c24eb       | 12785          | 1339         | 0.104732     |
    | 23 | a3c42688       | 11121          | 525          | 0.047208     |
    | 9  | 4681bb9d       | 6291           | 908          | 0.144333     |
    | 5  | 0f9a328c       | 5584           | 867          | 0.155265     |
    | 25 | a86a3e89       | 2497           | 325          | 0.130156     |
    | 7  | 2281a340       | 2243           | 30           | 0.0133749    |
    +----+----------------+----------------+--------------+--------------+


    app_category统计表:
           count(click)    sum(click)  avg(click)
    count  3.600000e+01  3.600000e+01   36.000000
    mean   1.123027e+06  1.906963e+05    0.082989
    std    4.589204e+06  8.788938e+05    0.077941
    min    1.000000e+00  0.000000e+00    0.000000
    25%    1.425000e+01  7.500000e-01    0.005639
    50%    1.142000e+03  4.500000e+01    0.080366
    75%    2.777425e+04  2.889750e+03    0.146233
    max    2.616559e+07  5.210822e+06    0.259678

<img src="./EDA/App_cat_vs_Click.png" style="zoom:30%" />

**这个特征各个取值类别不多，各个取值的点击率比较一致，其中有两个取值07d7df22和f95efa07点击率是高于全局平均点击率的，这两个取值的广告投放数连也很大**

### 1.2.11 device_id

和设备有关的几个特征的统计如下：

|          | device_id | device_ip | device_model | device_type | device_conn_type |
| -------- | --------- | --------- | ------------ | ----------- | ---------------- |
| 总数     | 40428967  | 40428967  | 40428967     | 40428967    | 40428967         |
| 独一数   | 2686408   | 6729486   | 8251         | 5           | 4                |
| 最高频值 | a99f214a  | 6b9769f2  | 8a4875bd     | 1           | 0                |
| 最高频数 | 33358308  | 208701    | 2455470      | 37304667    | 34886838         |



```python
i=9
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    device_id与点击率的统计表:共2686408不同取值
    +---------+-------------+----------------+--------------+--------------+
    |         | device_id   | count(click)   | sum(click)   | avg(click)   |
    |---------+-------------+----------------+--------------+--------------|
    | 1780272 | a99f214a    | 33358308       | 5809415      | 0.174152     |
    | 162650  | 0f7c61dc    | 21356          | 16190        | 0.758101     |
    | 2049923 | c357dbff    | 19667          | 12469        | 0.634006     |
    | 1547552 | 936e92fb    | 13712          | 875          | 0.0638127    |
    | 1846569 | afeffc18    | 9654           | 2211         | 0.229024     |
    | 1600102 | 987552d1    | 4187           | 0            | 0            |
    | 429077  | 28dc8687    | 4101           | 0            | 0            |
    | 2270026 | d857ffbb    | 4004           | 900          | 0.224775     |
    | 2171665 | cef4c8cc    | 3694           | 901          | 0.243909     |
    | 1853656 | b09da1c4    | 3655           | 479          | 0.131053     |
    | 638808  | 3cdb4052    | 3069           | 2421         | 0.788856     |
    | 35009   | 03559b29    | 2528           | 0            | 0            |
    | 29916   | 02da5312    | 2497           | 322          | 0.128955     |
    | 2212834 | d2e4c0ab    | 1466           | 0            | 0            |
    | 2537666 | f1d9c744    | 1392           | 0            | 0            |
    | 1801688 | abab24a7    | 1374           | 0            | 0            |
    | 98979   | 096a6f32    | 1369           | 0            | 0            |
    | 1626599 | 9af87478    | 1355           | 126          | 0.0929889    |
    | 1214408 | 73b81e30    | 1182           | 626          | 0.529611     |
    | 1970582 | bbcf14e4    | 1182           | 0            | 0            |
    +---------+-------------+----------------+--------------+--------------+


    device_id统计表:
           count(click)    sum(click)    avg(click)
    count  2.686408e+06  2.686408e+06  2.686408e+06
    mean   1.504945e+01  2.555482e+00  1.795149e-01
    std    2.035252e+04  3.544453e+03  3.551150e-01
    min    1.000000e+00  0.000000e+00  0.000000e+00
    25%    1.000000e+00  0.000000e+00  0.000000e+00
    50%    1.000000e+00  0.000000e+00  0.000000e+00
    75%    2.000000e+00  0.000000e+00  0.000000e+00
    max    3.335831e+07  5.809415e+06  1.000000e+00

**decice_id应该就是手机或者平板等设备的唯一编号,比如苹果5,华为P8之类的,这里发现a99f214a这个id占到了82.5%, 结合这个竞赛是2014年,这个id非常有可能还是苹果4的手机.因为苹果4手机当年号称卖出了1亿部!**
**这个特征取值很多,全部放进去训练是不可能的,它取值的及其不均衡,给我们不丢弃它的理由,可以将排名靠前的5个单独留下,剩下的归为一类处理. 或者进行hash处理，作为代表用户的特征**

### 1.2.12 device_ip


```python
i=10
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    device_ip与点击率的统计表:共6729486不同取值
    +---------+-------------+----------------+--------------+--------------+
    |         | device_ip   | count(click)   | sum(click)   | avg(click)   |
    |---------+-------------+----------------+--------------+--------------|
    | 2829892 | 6b9769f2    | 208701         | 45987        | 0.220349     |
    | 1765109 | 431b3174    | 135322         | 26356        | 0.194765     |
    | 1240642 | 2f323f36    | 88499          | 8734         | 0.0986904    |
    | 4616722 | af9205f9    | 87844          | 8438         | 0.0960566    |
    | 3867252 | 930ec31d    | 86996          | 8171         | 0.0939239    |
    | 4611824 | af62faf4    | 85802          | 8068         | 0.0940304    |
    | 15669   | 009a7861    | 85382          | 8248         | 0.0966012    |
    | 1060593 | 285aa37d    | 85313          | 8145         | 0.095472     |
    | 2619376 | 6394f6f6    | 83184          | 7733         | 0.0929626    |
    | 5706711 | d90a7774    | 82980          | 7705         | 0.0928537    |
    | 5215490 | c6563308    | 71290          | 15180        | 0.212933     |
    | 2309818 | 57cd4006    | 70449          | 15142        | 0.214936     |
    | 3096394 | 75bb1b58    | 70262          | 15041        | 0.21407      |
    | 759912  | 1cf29716    | 70028          | 15089        | 0.215471     |
    | 5831890 | ddd2926e    | 69816          | 14919        | 0.21369      |
    | 118733  | 0489ce3f    | 69756          | 15000        | 0.215035     |
    | 4426221 | a8536f3a    | 69594          | 15076        | 0.216628     |
    | 1907685 | 488a9a3e    | 69550          | 15025        | 0.216032     |
    | 5443218 | ceffea69    | 68731          | 14839        | 0.2159       |
    | 3629101 | 8a014cbb    | 68506          | 14679        | 0.214273     |
    +---------+-------------+----------------+--------------+--------------+


    device_ip统计表:
           count(click)    sum(click)    avg(click)
    count  6.729486e+06  6.729486e+06  6.729486e+06
    mean   6.007735e+00  1.020147e+00  2.027035e-01
    std    1.760677e+02  3.290346e+01  3.489186e-01
    min    1.000000e+00  0.000000e+00  0.000000e+00
    25%    1.000000e+00  0.000000e+00  0.000000e+00
    50%    2.000000e+00  0.000000e+00  0.000000e+00
    75%    3.000000e+00  1.000000e+00  2.857143e-01
    max    2.087010e+05  4.598700e+04  1.000000e+00

**设备的ip地址,分布很广,点击率的标准差也很小,但是很多ip的点击率都不错,其实这个特征可以看作是用户的画像特征,丢了是很可惜,进行独热编码是不太可能,可以考虑采用hash编码**

### 1.2.13 device_model


```python
i=11
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    device_model与点击率的统计表:共8251不同取值
    +------+----------------+----------------+--------------+--------------+
    |      | device_model   | count(click)   | sum(click)   | avg(click)   |
    |------+----------------+----------------+--------------+--------------|
    | 4460 | 8a4875bd       | 2455470        | 339356       | 0.138204     |
    | 934  | 1f0bc64f       | 1424546        | 319798       | 0.224491     |
    | 6949 | d787e91b       | 1405169        | 314574       | 0.223869     |
    | 3805 | 76dc4769       | 767961         | 145386       | 0.189314     |
    | 6078 | be6db1d7       | 742913         | 139977       | 0.188416     |
    | 5189 | a0f5f879       | 652751         | 108704       | 0.166532     |
    | 2484 | 4ea23a13       | 645153         | 136625       | 0.211771     |
    | 3934 | 7abbbd5c       | 636673         | 109847       | 0.172533     |
    | 7645 | ecb851b2       | 613048         | 111005       | 0.181071     |
    | 6855 | d4897fef       | 483582         | 81667        | 0.168879     |
    | 2551 | 5096d134       | 475264         | 80907        | 0.170236     |
    | 3612 | 711ee120       | 447450         | 96062        | 0.214688     |
    | 871  | 1ccc7835       | 426161         | 73671        | 0.172871     |
    | 7278 | e1eae715       | 421122         | 7313         | 0.0173655    |
    | 6334 | c6263d8a       | 397746         | 98506        | 0.247661     |
    | 4287 | 84ebbcd4       | 388015         | 105358       | 0.271531     |
    | 6079 | be74e6fe       | 379729         | 68989        | 0.18168      |
    | 4882 | 981edffc       | 361456         | 6299         | 0.0174267    |
    | 1900 | 3bd9e8e7       | 359934         | 75471        | 0.20968      |
    | 7754 | f07e20f8       | 359464         | 40650        | 0.113085     |
    +------+----------------+----------------+--------------+--------------+


    device_model统计表:
           count(click)     sum(click)   avg(click)
    count  8.251000e+03    8251.000000  8251.000000
    mean   4.899887e+03     832.028360     0.179165
    std    4.554862e+04    8145.354488     0.178233
    min    1.000000e+00       0.000000     0.000000
    25%    7.000000e+00       1.000000     0.057113
    50%    7.800000e+01      13.000000     0.157386
    75%    7.735000e+02     121.000000     0.239055
    max    2.455470e+06  339356.000000     1.000000

<img src="./EDA/Device_model_vs_Click.png" style="zoom:30%" />

**device_model这个理解为手机模式? 取值不少,这个特战是否要保留? 现在还没办法预见和下结论.**

### 1.2.14 device_type


```python
i=12
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea, headers='keys', numalign="left",tablefmt='psql'))
```

    device_type与点击率的统计表:共5不同取值
    +----+---------------+----------------+--------------+--------------+
    |    | device_type   | count(click)   | sum(click)   | avg(click)   |
    |----+---------------+----------------+--------------+--------------|
    | 1  | 1             | 3.73047e+07    | 6.31105e+06  | 0.169176     |
    | 0  | 0             | 2.22081e+06    | 467995       | 0.210731     |
    | 3  | 4             | 774272         | 73900        | 0.0954445    |
    | 4  | 5             | 129185         | 12123        | 0.0938422    |
    | 2  | 2             | 31             | 2            | 0.0645161    |
    +----+---------------+----------------+--------------+--------------+


    device_type之CTR分布图:

![png](./EDA/Device_type_vs_click.png)

**device_type从分布来看,绝对好特征,type1可能是iphone,type0可能是ipad**

### 1.2.15 device_conn_type


```python
i=13
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')

fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)

print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea, headers='keys', numalign="left",tablefmt='psql'))
```

    device_conn_type与点击率的统计表:共4不同取值
    +----+--------------------+----------------+--------------+--------------+
    |    | device_conn_type   | count(click)   | sum(click)   | avg(click)   |
    |----+--------------------+----------------+--------------+--------------|
    | 0  | 0                  | 3.48868e+07    | 6.31889e+06  | 0.181125     |
    | 1  | 2                  | 3.31744e+06    | 448815       | 0.135289     |
    | 2  | 3                  | 2.1818e+06     | 96092        | 0.0440426    |
    | 3  | 5                  | 42890          | 1270         | 0.0296106    |
    +----+--------------------+----------------+--------------+--------------+


    device_conn_type之CTR分布图:

![png](./EDA/Device_conn_type_vs_click.png)

**device_conn_type从分布来看,也是绝对好特征,这个应该是值wifi,4g,3g和2g网络**

**注意到，这个特征是唯一个投放量，点击数和点击率分布最为一致的**

### 1.2.16 C14


```python
i=14
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    C14与点击率的统计表:共2626不同取值
    +-----+-------+----------------+--------------+--------------+
    |     | C14   | count(click)   | sum(click)   | avg(click)   |
    |-----+-------+----------------+--------------+--------------|
    | 26  | 4687  | 948215         | 236460       | 0.249374     |
    | 957 | 21611 | 907004         | 50629        | 0.05582      |
    | 819 | 21189 | 765968         | 15231        | 0.0198846    |
    | 821 | 21191 | 765092         | 15051        | 0.0196721    |
    | 643 | 19771 | 730238         | 83215        | 0.113956     |
    | 644 | 19772 | 729305         | 81505        | 0.111757     |
    | 310 | 16208 | 657764         | 80375        | 0.122194     |
    | 685 | 20108 | 587773         | 145677       | 0.247846     |
    | 84  | 8330  | 554444         | 82004        | 0.147903     |
    | 651 | 19950 | 529145         | 65787        | 0.124327     |
    | 284 | 15705 | 510276         | 105412       | 0.206578     |
    | 280 | 15701 | 506797         | 102200       | 0.201659     |
    | 278 | 15699 | 504923         | 101489       | 0.200999     |
    | 282 | 15703 | 503358         | 96907        | 0.192521     |
    | 283 | 15704 | 503315         | 101765       | 0.202189     |
    | 286 | 15707 | 502374         | 99572        | 0.198203     |
    | 287 | 15708 | 502189         | 97222        | 0.193596     |
    | 281 | 15702 | 485719         | 78011        | 0.160609     |
    | 285 | 15706 | 477688         | 69982        | 0.146501     |
    | 328 | 16615 | 438490         | 82402        | 0.187922     |
    +-----+-------+----------------+--------------+--------------+


    C14统计表:
                    C14   count(click)     sum(click)   avg(click)
    count   2626.000000    2626.000000    2626.000000  2626.000000
    mean   20583.797030   15395.646230    2614.267327     0.143636
    std     4154.039762   63454.618282   11639.879551     0.129867
    min      375.000000       1.000000       0.000000     0.000000
    25%    19985.250000      99.000000       8.000000     0.056878
    50%    22108.500000     977.500000      97.000000     0.113040
    75%    22966.750000    4784.750000     604.750000     0.203886
    max    24052.000000  948215.000000  236460.000000     1.000000

**C14标准差不小,Cxx的特征应该是广告商的广告相关的特征,比如多少频次投放一次广告,在什么网站投放什么类型的广告,广告的是视频,弹窗,还是啥形式,广告多大的展示尺寸,在哪里展示,在屏幕上是如何的运动轨迹等等.这些都是广告商的商业秘密,必然要加密处理.**
**但是,可以肯定Cxx这些变量都挺重要,不能剔除掉.**

###1.2.17 C15


```python
i=15
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea, headers='keys', numalign="left",tablefmt='psql'))
```

    C15与点击率的统计表:共8不同取值
    +----+-------+----------------+--------------+--------------+
    |    | C15   | count(click)   | sum(click)   | avg(click)   |
    |----+-------+----------------+--------------+--------------|
    | 3  | 320   | 3.7709e+07     | 5.98094e+06  | 0.158608     |
    | 2  | 300   | 2.33729e+06    | 839925       | 0.359358     |
    | 1  | 216   | 298794         | 37988        | 0.127138     |
    | 5  | 728   | 74533          | 4246         | 0.0569681    |
    | 0  | 120   | 3069           | 58           | 0.0188987    |
    | 7  | 1024  | 2560           | 652          | 0.254688     |
    | 4  | 480   | 2137           | 572          | 0.267665     |
    | 6  | 768   | 1621           | 690          | 0.425663     |
    +----+-------+----------------+--------------+--------------+


    C15之CTR分布图:

![png](./EDA/C15_vs_Click.png)


                   C15  count(click)    sum(click)  avg(click)
    count     8.000000  8.000000e+00  8.000000e+00    8.000000
    mean    494.500000  5.053621e+06  8.581332e+05    0.208623
    std     315.322511  1.321909e+07  2.090365e+06    0.143214
    min     120.000000  1.621000e+03  5.800000e+01    0.018899
    25%     279.000000  2.454250e+03  6.320000e+02    0.109595
    50%     400.000000  3.880100e+04  2.468000e+03    0.206648
    75%     738.000000  8.084190e+05  2.384722e+05    0.290588
    max    1024.000000  3.770896e+07  5.980935e+06    0.425663

###1.2.18 C16

```python
i=16
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')
fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)
print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea, headers='keys', numalign="left",tablefmt='psql'))
```

    C16与点击率的统计表:共9不同取值
    +----+-------+----------------+--------------+--------------+
    |    | C16   | count(click)   | sum(click)   | avg(click)   |
    |----+-------+----------------+--------------+--------------|
    | 2  | 50    | 3.81366e+07    | 6.03759e+06  | 0.158315     |
    | 4  | 250   | 1.80633e+06    | 761093       | 0.421347     |
    | 1  | 36    | 298794         | 37988        | 0.127138     |
    | 6  | 480   | 103365         | 22178        | 0.21456      |
    | 3  | 90    | 74533          | 4246         | 0.0569681    |
    | 0  | 20    | 3069           | 58           | 0.0188987    |
    | 7  | 768   | 2560           | 652          | 0.254688     |
    | 5  | 320   | 2137           | 572          | 0.267665     |
    | 8  | 1024  | 1621           | 690          | 0.425663     |
    +----+-------+----------------+--------------+--------------+


    C16之CTR分布图:

![png](./EDA/C16_vs_click.png)


    C16统计表:
                   C16  count(click)    sum(click)  avg(click)
    count     9.000000  9.000000e+00  9.000000e+00    9.000000
    mean    337.555556  4.492107e+06  7.627851e+05    0.216138
    std     357.159317  1.263009e+07  1.993650e+06    0.143900
    min      20.000000  1.621000e+03  5.800000e+01    0.018899
    25%      50.000000  2.560000e+03  6.520000e+02    0.127138
    50%     250.000000  7.453300e+04  4.246000e+03    0.214560
    75%     480.000000  2.987940e+05  3.798800e+04    0.267665
    max    1024.000000  3.813655e+07  6.037589e+06    0.425663

**C15和C16这两个特征应该是屏幕的尺寸之类的参数,比如iphone4/4s的是320 X 480,ipad1/2的是768 X 1024**

**这里有个问题，屏幕的尺寸都是成对出现的，比如iphone4的是320X480，C15的320出现的次数最多，而C16的50出现最多！屏幕尺寸50的设备，是什么有这么多？**

### 1.2.19 C17


```python
i=17
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')

fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)

print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    C17与点击率的统计表:共435不同取值
    +-----+-------+----------------+--------------+--------------+
    |     | C17   | count(click)   | sum(click)   | avg(click)   |
    |-----+-------+----------------+--------------+--------------|
    | 56  | 1722  | 4.51349e+06    | 855780       | 0.189605     |
    | 168 | 2424  | 1.53107e+06    | 30282        | 0.0197783    |
    | 117 | 2227  | 1.47310e+06    | 166213       | 0.112832     |
    | 63  | 1800  | 1.19016e+06    | 146448       | 0.123049     |
    | 6   | 423   | 948215         | 236460       | 0.249374     |
    | 198 | 2480  | 918663         | 51522        | 0.0560837    |
    | 215 | 2502  | 855087         | 168489       | 0.197043     |
    | 238 | 2528  | 824907         | 110753       | 0.134261     |
    | 219 | 2506  | 803166         | 80738        | 0.100525     |
    | 159 | 2374  | 756358         | 191030       | 0.252566     |
    | 252 | 2545  | 713546         | 160335       | 0.224702     |
    | 69  | 1872  | 695237         | 209234       | 0.300953     |
    | 91  | 1994  | 604968         | 240007       | 0.396727     |
    | 139 | 2299  | 587773         | 145677       | 0.247846     |
    | 236 | 2526  | 586936         | 70734        | 0.120514     |
    | 68  | 1863  | 567425         | 91930        | 0.162013     |
    | 18  | 761   | 558460         | 82406        | 0.147559     |
    | 149 | 2333  | 512860         | 85653        | 0.16701      |
    | 90  | 1993  | 495667         | 178579       | 0.36028      |
    | 356 | 2665  | 485332         | 36939        | 0.0761108    |
    +-----+-------+----------------+--------------+--------------+


    C17统计表:
                   C17  count(click)     sum(click)  avg(click)
    count   435.000000  4.350000e+02     435.000000  435.000000
    mean   2269.000000  9.294015e+04   15781.760920    0.145537
    std     578.309594  2.809635e+05   52424.546677    0.114662
    min     112.000000  1.000000e+00       0.000000    0.000000
    25%    2171.500000  3.223500e+03     304.500000    0.063617
    50%    2504.000000  1.651000e+04    1695.000000    0.120477
    75%    2634.500000  7.060400e+04    8321.500000    0.208647
    max    2758.000000  4.513492e+06  855780.000000    0.800000

<img src="./EDA/C17_vs_click.png" style="zoom:30%" />

**C17 这个特征分布比较均匀.**

### 1.2.20 C18

```python
i=18
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')

fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)

print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea, headers='keys', numalign="left",tablefmt='psql'))
```

    C18与点击率的统计表:共4不同取值
    +----+-------+----------------+--------------+--------------+
    |    | C18   | count(click)   | sum(click)   | avg(click)   |
    |----+-------+----------------+--------------+--------------|
    | 0  | 0     | 1.6939e+07     | 2.68017e+06  | 0.158225     |
    | 3  | 3     | 1.36542e+07    | 1.99288e+06  | 0.145953     |
    | 2  | 2     | 7.11606e+06    | 2.09906e+06  | 0.294976     |
    | 1  | 1     | 2.71962e+06    | 92947        | 0.0341764    |
    +----+-------+----------------+--------------+--------------+


    C18之CTR分布图:

![png](./EDA/C18_vs_click.png)


**C18取值只有4个,而且影响差异很明显，是优质的特征**

### 1.2.21 C19

```python
i=19
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')

fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)

print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    C19与点击率的统计表:共68不同取值
    +----+-------+----------------+--------------+--------------+
    |    | C19   | count(click)   | sum(click)   | avg(click)   |
    |----+-------+----------------+--------------+--------------|
    | 2  | 35    | 1.21706e+07    | 2.0301e+06   | 0.166803     |
    | 4  | 39    | 8.82943e+06    | 2.15582e+06  | 0.244163     |
    | 11 | 167   | 3.1457e+06     | 509009       | 0.161811     |
    | 9  | 161   | 1.58776e+06    | 36795        | 0.0231741    |
    | 8  | 47    | 1.45171e+06    | 257334       | 0.177263     |
    | 58 | 1327  | 1.0926e+06     | 253404       | 0.231927     |
    | 19 | 297   | 1.01486e+06    | 74031        | 0.0729471    |
    | 10 | 163   | 926864         | 87527        | 0.0944335    |
    | 14 | 175   | 811516         | 99171        | 0.122205     |
    | 37 | 679   | 737468         | 82150        | 0.111395     |
    | 47 | 935   | 704359         | 83769        | 0.118929     |
    | 40 | 687   | 555698         | 104660       | 0.18834      |
    | 52 | 1063  | 522944         | 185939       | 0.355562     |
    | 5  | 41    | 513229         | 53208        | 0.103673     |
    | 0  | 33    | 478227         | 29473        | 0.0616297    |
    | 27 | 431   | 430005         | 105978       | 0.246458     |
    | 42 | 803   | 406539         | 30879        | 0.0759558    |
    | 57 | 1319  | 394524         | 90402        | 0.229142     |
    | 21 | 303   | 328180         | 102855       | 0.31341      |
    | 23 | 419   | 325027         | 13664        | 0.0420396    |
    +----+-------+----------------+--------------+--------------+
    
    C19之CTR分布图:

![png](./img/output_61_1.png)


    C19统计表:
                   C19  count(click)    sum(click)  avg(click)
    count    68.000000  6.800000e+01  6.800000e+01   68.000000
    mean    695.338235  5.945436e+05  1.009569e+05    0.136356
    std     528.835940  1.828143e+06  3.581900e+05    0.097313
    min      33.000000  2.000000e+00  0.000000e+00    0.000000
    25%     290.750000  1.917900e+04  1.712750e+03    0.075730
    50%     616.000000  1.030805e+05  1.122400e+04    0.112003
    75%     972.000000  3.975278e+05  4.089825e+04    0.163496
    max    1959.000000  1.217063e+07  2.155820e+06    0.500000

###1.2.22 C20

```python
i=20
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')

fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)

print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    C20与点击率的统计表:共172不同取值
    +-----+--------+----------------+--------------+--------------+
    |     | C20    | count(click)   | sum(click)   | avg(click)   |
    |-----+--------+----------------+--------------+--------------|
    | 0   | -1     | 1.89379e+07    | 3.65109e+06  | 0.192793     |
    | 65  | 100084 | 2.43848e+06    | 521672       | 0.213933     |
    | 110 | 100148 | 1.79489e+06    | 418279       | 0.233039     |
    | 86  | 100111 | 1.71673e+06    | 149552       | 0.0871143    |
    | 59  | 100077 | 1.5755e+06     | 276462       | 0.175476     |
    | 57  | 100075 | 1.54641e+06    | 253759       | 0.164095     |
    | 62  | 100081 | 1.33703e+06    | 253122       | 0.189316     |
    | 64  | 100083 | 1.07357e+06    | 207366       | 0.193156     |
    | 117 | 100156 | 1.03256e+06    | 98734        | 0.0956208    |
    | 147 | 100193 | 707521         | 15764        | 0.0222806    |
    | 132 | 100176 | 649479         | 77274        | 0.118978     |
    | 56  | 100074 | 587455         | 96620        | 0.164472     |
    | 61  | 100079 | 578206         | 80210        | 0.138722     |
    | 143 | 100189 | 476733         | 13002        | 0.0272731    |
    | 58  | 100076 | 457895         | 66408        | 0.145029     |
    | 146 | 100192 | 234785         | 7120         | 0.0303256    |
    | 144 | 100190 | 225665         | 5164         | 0.0228835    |
    | 145 | 100191 | 223351         | 18623        | 0.08338      |
    | 142 | 100188 | 220499         | 28713        | 0.130218     |
    | 11  | 100013 | 198110         | 25113        | 0.126763     |
    +-----+--------+----------------+--------------+--------------+


    C20统计表:
                     C20  count(click)    sum(click)  avg(click)
    count     172.000000  1.720000e+02  1.720000e+02  172.000000
    mean    99532.517442  2.350521e+05  3.991317e+04    0.134963
    std      7634.035375  1.476491e+06  2.842842e+05    0.065644
    min        -1.000000  1.000000e+00  0.000000e+00    0.000000
    25%    100057.750000  3.326250e+03  5.045000e+02    0.094257
    50%    100110.000000  1.240900e+04  1.677000e+03    0.128699
    75%    100171.250000  7.192650e+04  8.003000e+03    0.170796
    max    100248.000000  1.893792e+07  3.651093e+06    0.400000

<img src="./EDA/C20_vs_click.png" style="zoom:20%" />

**count 和 sum数量遥遥领先的是类别-1，应该是缺省值.**

### 1.2.23 C21

```python
i=21
fea=pd.read_csv('../Input/train/'+basecol+'VS'+corcol[i]+'.csv')

fea=fea.sort_values(by=[fea.columns[1]],ascending=False)
np.set_printoptions(suppress=True)

print(corcol[i]+'与点击率的统计表:'+'共'+str(len(fea))+'不同取值')
print(tabulate(fea.iloc[:20], headers='keys', numalign="left",tablefmt='psql'))
```

    C21与点击率的统计表:共60不同取值
    +----+-------+----------------+--------------+--------------+
    |    | C21   | count(click)   | sum(click)   | avg(click)   |
    |----+-------+----------------+--------------+--------------|
    | 6  | 23    | 8.89620e+06    | 1.89439e+06  | 0.212944     |
    | 54 | 221   | 5.05124e+06    | 846996       | 0.167681     |
    | 22 | 79    | 4.6148e+06     | 866402       | 0.187744     |
    | 13 | 48    | 2.16079e+06    | 298311       | 0.138056     |
    | 20 | 71    | 2.1085e+06     | 59461        | 0.0282007    |
    | 16 | 61    | 2.05364e+06    | 135378       | 0.0659211    |
    | 42 | 157   | 1.85610e+06    | 214131       | 0.115366     |
    | 7  | 32    | 1.78334e+06    | 410781       | 0.230343     |
    | 8  | 33    | 1.49756e+06    | 589917       | 0.393919     |
    | 15 | 52    | 1.20305e+06    | 325717       | 0.270743     |
    | 10 | 42    | 1.01891e+06    | 120256       | 0.118025     |
    | 14 | 51    | 850249         | 157689       | 0.185462     |
    | 2  | 15    | 766986         | 161746       | 0.210885     |
    | 52 | 212   | 659994         | 34201        | 0.0518202    |
    | 11 | 43    | 588961         | 44593        | 0.0757147    |
    | 39 | 117   | 419943         | 86383        | 0.205702     |
    | 55 | 229   | 406539         | 30879        | 0.0759558    |
    | 1  | 13    | 384314         | 81705        | 0.2126       |
    | 3  | 16    | 347178         | 90093        | 0.259501     |
    | 41 | 156   | 334906         | 23552        | 0.0703242    |
    +----+-------+----------------+--------------+--------------+


    C21之CTR分布图:

<img src="./EDA/C21_vs_click.png" style="zoom:20%" />


    C21统计表:
                  C21  count(click)    sum(click)  avg(click)
    count   60.000000  6.000000e+01  6.000000e+01   60.000000
    mean   110.666667  6.738161e+05  1.144178e+05    0.133613
    std     71.179093  1.466070e+06  2.954893e+05    0.072701
    min      1.000000  4.970000e+02  7.200000e+01    0.028201
    25%     51.750000  2.194700e+04  3.090250e+03    0.075896
    50%     97.500000  1.358495e+05  1.474950e+04    0.116100
    75%    165.000000  4.621975e+05  6.502200e+04    0.183208
    max    255.000000  8.896205e+06  1.894394e+06    0.393919

### 1.2.24 数值特征相关性

数值特征的热力图分布如下：

![CTR_coor](./EDA/CTR_coor.png)

**从热力图我们可以看出，C14和C17确实有着极强的相关性，并且对click的影响也类似，可以保留其中一个，我们保留C17,去掉C14。因为C14的取值非常多（2626），而C17的取值较少（435），可以推断C17和C14有可能是包含关系。**

将各个特征与点击click的相关系数列表如下：

| 特征             | 相关性系数 |
| ---------------- | ---------- |
| Id               | 0.000236   |
| hour             | 0.007738   |
| C1               | 0.036478   |
| banner_pos       | 0.026064   |
| device_type      | 0.037686   |
| device_conn_type | 0.083389   |
| C14              | 0.060429   |
| C15              | 0.032616   |
| C16              | 0.130002   |
| C18              | 0.022249   |
| C19              | 0.004313   |
| C20              | 0.057789   |
| C21              | 0.070673   |



选取与click相关性比较高的（threshold=0.0077）作为进入训练的特征。

结合上述综合分析，筛选出以下特征作为训练特征：

|      | 筛选出来的特征   | 数值类型 | 独一数   | 特征处理                                |
| ---- | ---------------- | -------- | -------- | --------------------------------------- |
| 1    | C1               | 数值型   | 7        | 类别化                                  |
| 2    | banner_pos       | 数值型   | 7        | 类别化                                  |
| 3    | device_type      | 数值型   | 5        | 不作处理                                |
| 4    | device_conn_type | 数值型   | 4        | 不作处理                                |
| 5    | C17              | 数值型   | 435      | 不作处理                                |
| 6    | C15              | 数值型   | 8        | C15XC16合并为一个特征                   |
| 7    | C16              | 数值型   | 9        | C15XC16合并为一个特征                   |
| 8    | C18              | 数值型   | 4        | 不作处理                                |
| 9    | C19              | 数值型   | 68       | 不作处理                                |
| 10   | C20              | 数值型   | 172      | 不作处理                                |
| 11   | C21              | 数值型   | 60       | 不作处理                                |
| 12   | hour             | 时间型   | 40428967 | 分段汇总，类别化或转化为连续变量        |
| 13   | site_category    | 类别型   | 26       | labelencoder 或者hash                   |
| 14   | app_domain       | 类别型   | 559      | labelencoder 或者hash                   |
| 15   | app_category     | 类别型   | 36       | labelencoder 或者hash                   |
| 16   | device_model     | 类别型   | 8251     | labelencoder 或者hash                   |
| 17   | device_id        | 类别型   | 2686408  | device_id+device_ip，hash后作为代表用户 |
| 18   | device_ip        | 类别型   | 6729486  | device_id+device_ip，hash后作为代表用户 |



而id，app_id, site_id, site_domain，C14将直接舍弃。

## W1.3 特征工程初探

1. 类别型特征编码

   可以选择label-encode，one-hot -encode和hash-encode

2. 采样

   可以发现数据集的正负样本是不协调的，正样本和负样本的比例大约1:4，可以采取下采样的方式

3. 交叉特征
	基本特征确定后,需要衍生一些交叉特征,比如时间特征,可以衍生出连续小时特征,星期类别特征,小时每天类别特征等.
	还有某个用户历史点击数的统计特征等.

## 参考文献

[1] *DMITRY EFIMOV*: CLICK-THROUGH RATE PREDICTION –TOP-5 SOLUTION FOR THE AVAZU CONTEST. *MATHEMATICA MONTISNIGRI:Vol XXXII (2015) 158-171*

[2] *Antriksh Agarwal,etc.* : A comparative study of Linear learning methods in Click-Through Rate Prediction. *ICSCTI 2015*
